cwd=$(pwd)
cd ~/Data/opinion_dynamics/02c_stance_detection/data/01_raw_data/qanda/
jq -r '[.id_str, .retweeted_status.id_str, .quoted_status.id_str,  .user.id_str, .created_at,.retweeted_status.extended_tweet.full_text, (if .truncated then .extended_tweet.full_text else .text end), ([.entities.hashtags[].text] | join(";;;")), (try ([.retweeted_status.extended_tweet.entities.hashtags[].text] | join(";;;")) catch null), (try ([.entities.user_mentions[].id_str] | join(";;;")) catch null), (try ([.retweeted_status.extended_tweet.entities.user_mentions[].id_str] | join(";;;")) catch null), (try ([.retweeted_status.extended_tweet.entities.urls[].expanded_url] | join(";;;")) catch null), (try ([(if .truncated then .extended_tweet else . end).entities.urls[].expanded_url] | join(";;;")) catch null)] | @csv' qanda-20200131-20201130-tweets.json > qanda_t.csv &
jq -r '.retweeted_status | select(. != null) | [.id_str, .retweeted_status.id_str, .quoted_status.id_str,  .user.id_str, .created_at,.retweeted_status.extended_tweet.full_text, (if .truncated then .extended_tweet.full_text else .text end), ([.entities.hashtags[].text] | join(";;;")), (try ([.retweeted_status.extended_tweet.entities.hashtags[].text] | join(";;;")) catch null), (try ([.entities.user_mentions[].id_str] | join(";;;")) catch null), (try ([.retweeted_status.extended_tweet.entities.user_mentions[].id_str] | join(";;;")) catch null), (try ([.retweeted_status.extended_tweet.entities.urls[].expanded_url] | join(";;;")) catch null), (try ([(if .truncated then .extended_tweet else . end).entities.urls[].expanded_url] | join(";;;")) catch null)] | @csv' qanda-20200131-20201130-tweets.json > qanda_r.csv &
jq -r '.quoted_status | select(. != null) | [.id_str, .retweeted_status.id_str, .quoted_status.id_str,  .user.id_str, .created_at,.retweeted_status.extended_tweet.full_text, (if .truncated then .extended_tweet.full_text else .text end), ([.entities.hashtags[].text] | join(";;;")), (try ([.retweeted_status.extended_tweet.entities.hashtags[].text] | join(";;;")) catch null), (try ([.entities.user_mentions[].id_str] | join(";;;")) catch null), (try ([.retweeted_status.extended_tweet.entities.user_mentions[].id_str] | join(";;;")) catch null), (try ([.retweeted_status.extended_tweet.entities.urls[].expanded_url] | join(";;;")) catch null), (try ([(if .truncated then .extended_tweet else . end).entities.urls[].expanded_url] | join(";;;")) catch null)] | @csv' qanda-20200131-20201130-tweets.json >> qanda_q.csv &
wait
cat qanda_*.csv >> qanda.csv
rm qanda_t.csv
rm qanda_r.csv
rm qanda_q.csv
cd $cwd